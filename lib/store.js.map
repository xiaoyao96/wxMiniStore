{"version":3,"file":"store.js","sources":["../src/common.js","../src/diff.js","../src/index.js"],"sourcesContent":["export const TYPE_ARRAY = \"[object Array]\";\r\nexport const TYPE_OBJECT = \"[object Object]\";\r\nexport const _typeOf = function(val) {\r\n  return Object.prototype.toString.call(val);\r\n};\r\nexport const _deepClone = function(obj) {\r\n  return JSON.parse(JSON.stringify(obj));\r\n};\r\n","import { _typeOf, TYPE_ARRAY, TYPE_OBJECT } from \"./common\";\r\n/**\r\n * diff库\r\n * @author Leisure\r\n * @update 2019.11.27\r\n * @param {object} current - 当前状态\r\n * @param {object} prev - 之前状态\r\n */\r\nconst diff = function diff(current = {}, prev = {}) {\r\n  let result = {};\r\n  updateDiff(current, prev, \"\", result);\r\n  nullDiff(current, prev, \"\", result);\r\n  return result;\r\n};\r\n\r\nconst updateDiff = function updateDiff(\r\n  current = {},\r\n  prev = {},\r\n  root = \"\",\r\n  result = {}\r\n) {\r\n  if(_typeOf(current) === TYPE_ARRAY && ((_typeOf(prev) === TYPE_ARRAY && current.length !== prev.length) || _typeOf(prev) !== TYPE_ARRAY)){\r\n    result[root] = current\r\n    return;\r\n  }\r\n  Object.entries(current).forEach(item => {\r\n    let key = item[0],\r\n      value = item[1],\r\n      path = root === \"\" ? key : root + \".\" + key;\r\n    if (_typeOf(current) === TYPE_ARRAY) {\r\n      path = root === \"\" ? key : root + \"[\" + key + \"]\";\r\n    }\r\n    if (!prev.hasOwnProperty(key)) {\r\n      result[path] = value;\r\n    } else if (\r\n      (_typeOf(prev[key]) === TYPE_OBJECT &&\r\n        _typeOf(current[key]) === TYPE_OBJECT) ||\r\n      (_typeOf(prev[key]) === TYPE_ARRAY &&\r\n        _typeOf(current[key]) === TYPE_ARRAY)\r\n    ) {\r\n      updateDiff(current[key], prev[key], path, result);\r\n    } else if (prev[key] !== current[key]) {\r\n      result[path] = value;\r\n    }\r\n  });\r\n  return result;\r\n};\r\n\r\nconst nullDiff = function nullDiff(\r\n  current = {},\r\n  prev = {},\r\n  root = \"\",\r\n  result = {}\r\n) {\r\n  if(_typeOf(current) === TYPE_ARRAY && ((_typeOf(prev) === TYPE_ARRAY && current.length !== prev.length) || _typeOf(prev) !== TYPE_ARRAY)){\r\n    return;\r\n  }\r\n  Object.entries(prev).forEach(item => {\r\n    let key = item[0],\r\n      path = root === \"\" ? key : root + \".\" + key;\r\n    if (_typeOf(current) === TYPE_ARRAY) {\r\n      path = root === \"\" ? key : root + \"[\" + key + \"]\";\r\n    }\r\n\r\n    if (!current.hasOwnProperty(key)) {\r\n      result[path] = null;\r\n    } else if (\r\n      (_typeOf(prev[key]) === TYPE_OBJECT &&\r\n        _typeOf(current[key]) === TYPE_OBJECT) ||\r\n      (_typeOf(prev[key]) === TYPE_ARRAY &&\r\n        _typeOf(current[key]) === TYPE_ARRAY)\r\n    ) {\r\n      nullDiff(current[key], prev[key], path, result);\r\n    }\r\n  });\r\n  return result;\r\n};\r\n\r\nexport default diff;\r\n","import { _typeOf, _deepClone, TYPE_ARRAY, TYPE_OBJECT } from \"./common\";\r\nimport diff from \"./diff\";\r\nimport pkg from \"../package.json\";\r\nconst Version = pkg.version;\r\nconsole.log(\"当前wxministore版本：\" + Version);\r\n/**\r\n * Store\r\n * @author Leisure\r\n * @update 2019.11.27\r\n * @version 1.2.8\r\n */\r\nclass Store {\r\n  version = Version;\r\n  $state = {};\r\n  $r = [];\r\n  constructor(option) {\r\n    //必要参数的默认值处理\r\n    const {\r\n      openPart = false,\r\n      behavior,\r\n      methods = {},\r\n      pageLisener = {},\r\n      nonWritable = false\r\n    } = option;\r\n\r\n    //状态初始化\r\n    this.$state = {};\r\n    if (_typeOf(option.state) === TYPE_OBJECT) {\r\n      this.$state = Object.assign({}, _deepClone(option.state));\r\n    }\r\n    //页面+组件树\r\n    this.$r = [];\r\n    //创建时，添加组件\r\n    const _create = function(r, o = {}) {\r\n      r.$store = {};\r\n      const { useProp } = o;\r\n      if (o.hasOwnProperty(\"useProp\")) {\r\n        if (\r\n          (useProp && typeof useProp === \"string\") ||\r\n          _typeOf(useProp) === TYPE_ARRAY\r\n        ) {\r\n          r.$store.useProp = [].concat(useProp);\r\n        } else {\r\n          r.$store.useProp = [];\r\n        }\r\n      }\r\n\r\n      r.$store.useStore = canUseStore(o);\r\n      if (canUseStore(o)) {\r\n        _store.$r.push(r);\r\n        if (r.$store.useProp) {\r\n          r.setData({\r\n            $state: _filterKey(\r\n              _store.$state,\r\n              r.$store.useProp,\r\n              (key, usekey) => key === usekey\r\n            )\r\n          });\r\n        } else {\r\n          r.setData({\r\n            $state: _store.$state\r\n          });\r\n        }\r\n      }\r\n    };\r\n    //销毁时，移除组件\r\n    const _destroy = function(r) {\r\n      let index = _store.$r.findIndex(item => item === r);\r\n      if (index > -1) {\r\n        _store.$r.splice(index, 1);\r\n      }\r\n    };\r\n    //状态局部模式\r\n    this.$openPart = openPart;\r\n    //其他参数\r\n    const _store = this;\r\n    const pageLife = [\r\n      \"data\",\r\n      \"onLoad\",\r\n      \"onShow\",\r\n      \"onReady\",\r\n      \"onHide\",\r\n      \"onUnload\",\r\n      \"onPullDownRefresh\",\r\n      \"onReachBottom\",\r\n      \"onShareAppMessage\",\r\n      \"onPageScroll\",\r\n      \"onTabItemTap\"\r\n    ];\r\n    const canUseStore = function(o = {}) {\r\n      return (openPart === true && o.useStore === true) || !openPart;\r\n    };\r\n\r\n    const originPage = Page,\r\n      originComponent = Component;\r\n\r\n    //重写Page\r\n    App.Page = function(o = {}, ...args) {\r\n      if (canUseStore(o)) {\r\n        //状态注入\r\n        o.data = Object.assign(o.data || {}, {\r\n          $state: _store.$state\r\n        });\r\n      }\r\n      //行为注入\r\n      Object.keys(methods).forEach(key => {\r\n        //不能是周期事件\r\n        if (\r\n          typeof methods[key] === \"function\" &&\r\n          !pageLife.some(item => item === key)\r\n        ) {\r\n          o[key] = methods[key];\r\n        }\r\n      });\r\n      //覆盖原周期\r\n      const originCreate = o.onLoad;\r\n      o.onLoad = function() {\r\n        _create(this, o);\r\n        originCreate && originCreate.apply(this, arguments);\r\n      };\r\n      const originonDestroy = o.onUnload;\r\n      o.onUnload = function() {\r\n        _destroy(this);\r\n        originonDestroy && originonDestroy.apply(this, arguments);\r\n      };\r\n      //其他页面周期事件注入 pageListener\r\n      Object.keys(pageLisener).forEach(key => {\r\n        //不能是周期事件\r\n        if (\r\n          typeof pageLisener[key] === \"function\" &&\r\n          pageLife.some(item => item === key)\r\n        ) {\r\n          const originLife = o[key];\r\n          o[key] = function() {\r\n            pageLisener[key].apply(this, arguments);\r\n            originLife && originLife.apply(this, arguments);\r\n          };\r\n        }\r\n      });\r\n      originPage(o, ...args);\r\n    };\r\n\r\n    if (!nonWritable) {\r\n      try {\r\n        Page = App.Page;\r\n      } catch (e) {}\r\n    }\r\n\r\n    //重写组件\r\n    App.Component = function(o = {}, ...args) {\r\n      //状态注入\r\n      if (canUseStore(o)) {\r\n        o.data = Object.assign(o.data || {}, {\r\n          $state: _store.$state\r\n        });\r\n      }\r\n      //行为注入\r\n      Object.keys(methods).forEach(key => {\r\n        //不能是周期事件\r\n        if (\r\n          typeof methods[key] === \"function\" &&\r\n          !pageLife.some(item => item === key)\r\n        ) {\r\n          o.methods || (o.methods = {});\r\n          o.methods[key] = methods[key];\r\n        }\r\n      });\r\n      //behavior\r\n      if (behavior) {\r\n        o.behaviors = [behavior, ...(o.behaviors || [])];\r\n      }\r\n      const { lifetimes = {} } = o;\r\n\r\n      let originCreate = lifetimes.attached || o.attached,\r\n        originonDestroy = lifetimes.detached || o.detached;\r\n      const attached = function() {\r\n        _create(this, o);\r\n        originCreate && originCreate.apply(this, arguments);\r\n      };\r\n\r\n      const detached = function() {\r\n        _destroy(this);\r\n        originonDestroy && originonDestroy.apply(this, arguments);\r\n      };\r\n      if (_typeOf(o.lifetimes) === TYPE_OBJECT) {\r\n        o.lifetimes.attached = attached;\r\n        o.lifetimes.detached = detached;\r\n      } else {\r\n        o.attached = attached;\r\n        o.detached = detached;\r\n      }\r\n\r\n      //覆盖原周期\r\n\r\n      originComponent(o, ...args);\r\n    };\r\n    if (!nonWritable) {\r\n      try {\r\n        Component = App.Component;\r\n      } catch (e) {}\r\n    }\r\n  }\r\n\r\n  setState(obj, fn = () => {}) {\r\n    if (_typeOf(obj) !== TYPE_OBJECT) {\r\n      throw new Error(\"setState的第一个参数须为object!\");\r\n    }\r\n    console.time && console.time(\"setState\");\r\n    let prev = this.$state;\r\n    let current = setData(obj, prev);\r\n    this.$state = current;\r\n    //如果有组件\r\n    if (this.$r.length > 0) {\r\n      let diffObj = diff(current, prev);\r\n      console.log(\"diff后实际设置的值：\", _deepClone(diffObj));\r\n      let keys = Object.keys(diffObj);\r\n      if (keys.length > 0) {\r\n        const newObj = {};\r\n        keys.forEach(key => {\r\n          newObj[\"$state.\" + key] = diffObj[key];\r\n        });\r\n        let pros = this.$r.map(r => {\r\n          if (r.$store.hasOwnProperty(\"useProp\")) {\r\n            let useprops = _filterKey(\r\n              newObj,\r\n              r.$store.useProp,\r\n              (key, useKey) =>\r\n                key === \"$state.\" + useKey ||\r\n                !!key.match(new RegExp(\"^[$]state.\" + useKey + \"[.|[]\", \"g\"))\r\n            );\r\n            if (Object.keys(useprops).length > 0) {\r\n              return new Promise(resolve => {\r\n                r.setData(useprops, resolve);\r\n              });\r\n            } else {\r\n              return Promise.resolve();\r\n            }\r\n          }\r\n          return new Promise(resolve => {\r\n            r.setData(newObj, resolve);\r\n          });\r\n        });\r\n        Promise.all(pros).then(fn);\r\n      } else {\r\n        fn();\r\n      }\r\n    } else {\r\n      fn();\r\n    }\r\n    console.timeEnd && console.timeEnd(\"setState\");\r\n  }\r\n  getState() {\r\n    return _deepClone(this.$state);\r\n  }\r\n}\r\n\r\nconst _filterKey = function(obj, useKeys = [], fn) {\r\n  let result = {};\r\n  Object.keys(obj)\r\n    .filter(key =>\r\n      useKeys.some(usekey => {\r\n        return fn(key, usekey);\r\n      })\r\n    )\r\n    .forEach(key => {\r\n      result[key] = obj[key];\r\n    });\r\n  return result;\r\n};\r\n\r\nconst setData = function(obj, data) {\r\n  let result = _deepClone(data);\r\n  let origin = _deepClone(obj);\r\n  Object.keys(origin).forEach(key => {\r\n    dataHandler(key, origin[key], result);\r\n  });\r\n  return result;\r\n};\r\n\r\nconst dataHandler = function(key, result, data) {\r\n  let arr = pathHandler(key);\r\n  let d = data;\r\n  for (let i = 0; i < arr.length - 1; i++) {\r\n    keyToData(arr[i], arr[i + 1], d);\r\n    d = d[arr[i]];\r\n  }\r\n  d[arr[arr.length - 1]] = result;\r\n};\r\n\r\nconst pathHandler = function(key) {\r\n  let current = \"\",\r\n    keyArr = [];\r\n  for (let i = 0, len = key.length; i < len; i++) {\r\n    if (key[0] === \"[\") {\r\n      throw new Error(\"key值不能以[]开头\");\r\n    }\r\n    if (key[i].match(/\\.|\\[/g)) {\r\n      cleanAndPush(current, keyArr);\r\n      current = \"\";\r\n    }\r\n    current += key[i];\r\n  }\r\n  cleanAndPush(current, keyArr);\r\n  return keyArr;\r\n};\r\n\r\nconst cleanAndPush = function(key, arr) {\r\n  let r = cleanKey(key);\r\n  if (r !== \"\") {\r\n    arr.push(r);\r\n  }\r\n};\r\n\r\nconst keyToData = function(prev, current, data) {\r\n  if (prev === \"\") {\r\n    return;\r\n  }\r\n  const type = _typeOf(data[prev]);\r\n  if (typeof current === \"number\" && type !== TYPE_ARRAY) {\r\n    data[prev] = [];\r\n  } else if (typeof current === \"string\" && type !== TYPE_OBJECT) {\r\n    data[prev] = {};\r\n  }\r\n};\r\n\r\nconst cleanKey = function(key) {\r\n  if (key.match(/\\[\\S+\\]/g)) {\r\n    let result = key.replace(/\\[|\\]/g, \"\");\r\n    if (!Number.isNaN(parseInt(result))) {\r\n      return +result;\r\n    } else {\r\n      throw new Error(`[]中必须为数字`);\r\n    }\r\n  }\r\n  return key.replace(/\\[|\\.|\\]| /g, \"\");\r\n};\r\n\r\nexport default Store;\r\n"],"names":["TYPE_ARRAY","TYPE_OBJECT","_typeOf","val","Object","prototype","toString","call","_deepClone","obj","JSON","parse","stringify","diff","current","prev","result","updateDiff","root","length","entries","forEach","key","item","value","path","hasOwnProperty","nullDiff","Version","pkg","version","console","log","Store","option","$state","$r","openPart","behavior","methods","pageLisener","nonWritable","state","assign","_create","r","o","$store","useProp","concat","useStore","canUseStore","push","setData","_filterKey","_store","usekey","_destroy","index","findIndex","splice","$openPart","this","pageLife","originPage","Page","originComponent","Component","args","data","keys","some","originCreate","onLoad","apply","arguments","originonDestroy","onUnload","originLife","App","e","behaviors","attached","detached","lifetimes","fn","Error","time","diffObj","newObj","pros","map","useprops","useKey","match","RegExp","Promise","resolve","all","then","timeEnd","useKeys","filter","origin","dataHandler","arr","pathHandler","d","i","keyArr","len","cleanAndPush","cleanKey","keyToData","type","replace","Number","isNaN","parseInt"],"mappings":"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"}